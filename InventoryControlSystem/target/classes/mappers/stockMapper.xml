<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mapper.StockMapper">

	<resultMap type="com.itwillbs.domain.StockVO" id="stock">
		<result property="pno" column="pno"/>
		<result property="warehouse_code" column="warehouse_code"/>
		<result property="count" column="count"/>
		<result property="pname" column="pname"/>
		<result property="company" column="divcode"/>
		<result property="category" column="category"/>
		<result property= "type" column= "type"/>
		<result property= "keyword" column="keyword"/>
		
	</resultMap>
	
	<!-- 재고 리스트 조회 -->
	<select id = "selectStockList" resultType = "StockVO">
	select stock.pno, stock.warehouse_code, stock.count,
	product.pname, product.company, category.category
	from stock
	inner join product
	on stock.pno=product.pno
	inner join category
	on stock.category = category.category_code
	</select>
	
	<!-- 글 목록 조회(페이징처리) -->
	<select id = "selectStockListPage" resultType = "StockVO">
		<![CDATA[
		select stock.pno, stock.warehouse_code, stock.count,
		product.pname, product.company, category.category
		from stock
		inner join product
		on stock.pno=product.pno
		inner join category
		on stock.category = category.category_code
		where stock.pno > 0 order by stock.pno desc limit #{page} , 10
		]]>
	</select>

	

		
	<!-- 검색기능 sql 구문 (criteria) -->
	<sql id = "criteria">
	<trim prefix="where (" suffix= ")" prefixOverrides="OR">

				<choose>
					<when test="type == 'all'.toString()">
						CONCAT(stock.pno, stock.warehouse_code, 
						product.pname, product.company, category.category) 
						LIKE CONCAT('%',#{keyword},'%')
					</when>
					<when test="type == 'pno'.toString()">
						stock.pno LIKE CONCAT('%',#{keyword},'%')
					</when>
					<when test="type == 'category'.toString()">
						category.category LIKE CONCAT('%',#{keyword},'%')
					</when>
					<when test="type == 'pname'.toString()">
						product.pname LIKE CONCAT('%',#{keyword},'%')
					</when>
					<when test="type == 'company'.toString()">
						product.company LIKE CONCAT('%',#{keyword},'%')
					</when>
					<when test="type == 'warehouse_code'.toString()">
						stock.warehouse_code LIKE CONCAT('%',#{keyword},'%')
					</when>
				</choose>
	</trim>
	</sql>
	
	<!-- 검색 구문 (책) -->
	<select id = "getListPaging" resultType="StockVO">
	<![CDATA[
	select stock.pno, stock.warehouse_code, stock.count,
	product.pname, product.company, category.category
	from stock
	inner join product
	on stock.pno=product.pno
	inner join category
	on stock.category = category.category_code
	where
	]]>
	<include refid="criteria"></include>
	</select>
	
	<!-- 글 목록 조회(페이징처리-Cri) -->
	<select id = "selectStockListCri" resultType = "StockVO">
		
		select stock.pno, stock.warehouse_code, stock.count,
		product.pname, product.company, category.category
		from stock
		inner join product
		on stock.pno=product.pno
		inner join category
		on stock.category = category.category_code
		<if test="keyword != null">
			<include refid = "criteria"></include>
		</if>
		order by stock.pno desc 
		limit #{startPage} , #{pageSize}
		
	</select>
		<!-- 총 글 개수 조회 -->
	<select id = "totalCount" resultType = "int">
		select count(concat(stock.pno, stock.warehouse_code, stock.count,
		product.pname, product.company, category.category))
		from stock
		inner join product
		on stock.pno=product.pno
		inner join category
		on stock.category = category.category_code
		<if test="keyword != null">
			<include refid="criteria"></include>
		</if>
		
	</select>
	
	
	
	  
</mapper>